define(["require","../../app"],function(e){var t=e("../../app");t.directive("checkboxGroup",function(){return{restrict:"EA",scope:{options:"=",confirmHandler:"&",cancelHandler:"&"},replace:!1,templateUrl:"src/common/directive/checkboxGroup/tpl.html",link:function(e,t,n){function r(){var t=e.options.data,n=[];for(var r=0,i;i=t[r++];)for(var s=0,o;o=i.items[s++];)o.checked&&n.push(o.key);return n}function i(){var t=e.options.data;for(var n=0,r;r=t[n++];){var i=r.items;for(var s=0,o;o=i[s++];)o.isDefault?o.checked=!0:o.checked=!1}e.options.checkedValues=e.defaultValues}function s(){var t=e.options.checkedValues,n=e.options.data;for(var r=0,i;i=n[r++];){var s=i.items;for(var o=0,u;u=s[o++];)$.inArray(u.key,t)!=-1?u.checked=!0:u.checked=!1}}function o(){var t=e.options.data,n=[];for(var r=0,i;i=t[r++];){var s=i.items;for(var o=0,u;u=s[o++];)u.isDefault&&n.push(u.key)}return n}function u(){var t=e.options.data;for(var n=0,r;r=t[n++];){var i=r.items;for(var s=0,o;o=i[s++];)o.isDefault?o.checked=!0:o.checked=!1}e.options.checkedValues=e.defaultValues}function a(){var t=e.defaultValues,n=e.options.checkedValues;if(t.length!=n.length)return!1;for(var r=0,i;i=t[r++];)if($.inArray(i,n)==-1)return!1;return!0}function f(){a()?e.checkboxGroupType="default":e.checkboxGroupType="selfDefine"}e.defaultValues=o(),e.error="",e.options.checkedValues&&e.options.checkedValues.length!=0?s():i(),f(),e.defaultClick=function(){u()},e.itemClick=function(){var t=r(),n=e.options.maxItems||8,i=t.length;if(i==0){e.error="请选择至少1个指标";return}if(i>n){e.error="请选择少于"+n+"个指标";return}e.error="",e.options.checkedValues=t,f()},e.$watch("options.checkedValues",function(e,t){e!=t&&(s(),f())},!0)}}})});