define(["require","../../app"],function(e){var t=e("../../app");t.directive("tableControl",["$http","ajaxService","$filter",function(e,t,n){return{restrict:"EA",templateUrl:"src/common/directive/table/tpl.html",scope:{options:"="},replace:!1,link:function(e,t,r){function i(t){var n=e.options.data;for(var r=0,i;i=e.dataSource[r++];)i.selected=t;for(var r=0,i;i=n[r++];)i.selected=t}function s(){var t=e.dataSource;if(!t.length)return!1;for(var n=0,r;r=t[n++];)if(!r.selected)return!1;return!0}function o(e){var t=[];for(var n=0,r;r=e[n++];)r.selected&&t.push(r);return t}function u(){var t={};e.dataSource=$.extend(!0,[],e.options.data);var r=e.options.cols,i=r.length;for(var s=0;s<i;s++){var o=r[s];o&&o.filter&&(t[o.field]=o.filter)}for(var s=0,o;o=e.dataSource[s++];)for(var u=0,f;f=r[u++];){var l=f.field,c=t[l];if(c){var h=c.split(":"),p=$.extend(!0,[],h);p[0]=o[l],o[l]=n(h[0]).apply(undefined,p)}}a()}function a(){s()?e.selectCurAll=!0:e.selectCurAll=!1}e.dataSource=[],e.options.pageSize=e.options.pageSize||20,e.mainScope=e.options.mainScope,e.onSelectCurAllChange=function(){e.selectCurAll?(i(!0),e.options.onSelectAll&&e.options.onSelectAll()):i(!1),e.options.selectedItems=o(e.options.data)},e.onItemSelectChange=function(t,n){var r=e.dataSource[t];r.selected=n;var i=e.options.data[t];i.selected=n,r.selected==0?e.selectCurAll=!1:s()&&(e.selectCurAll=!0),e.options.selectedItems=o(e.options.data),e.options&&e.options.onItemSelect&&e.options.onItemSelect()},e.onPageChanged=function(){e.options.onPageChange&&e.options.onPageChange(e.curPage)},e.$watch("options.data",function(e,t){u()},!0),e.$watch("options.cols",function(e,t){u()},!0)}}}])});