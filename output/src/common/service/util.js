define(["require","../app","module/config","moment"],function(e){var t=e("../app"),n=e("module/config"),r=e("moment");t.factory("util",["ajaxService","$rootScope","$modal",function(e,t,i,s){var o=n.SALARY_TYPE[1].id;return{isEmpty:function(e){return angular.isUndefined(e)||e===""||e===null},alert:function(e){i.open({animation:!1,templateUrl:"src/common/service/alert/alert.html",controller:["$scope","$modalInstance",function(t,n){t.tip=e,t.closeHandler=function(){n.dismiss()}}],size:"sm"})},info:function(e){i.open({animation:!1,templateUrl:"src/common/service/info/info.html",controller:["$scope","$modalInstance","$timeout",function(t,n,r){t.tip=e,t.closeHandler=function(){n.dismiss()},r(function(){n.dismiss()},1e3)}],size:"sm"})},confirm:function(e,t){i.open({animation:!1,templateUrl:"src/common/service/confirm/confirm.html",controller:["$scope","$modalInstance",function(n,r){n.tip=e,n.saveHandler=function(){r.dismiss(),t()},n.closeHandler=function(){r.dismiss()}}],size:"sm"})},buildSelectOpitons:function(e,t){var r=[];for(var i in e)e.hasOwnProperty(i)&&r.push({id:+i,name:e[i]});return t&&r.unshift(n.EMPTY),r},findIndexInObjArr:function(e,t,n){for(var r=0,i;i=e[r++];)if(i[t]==n)return r-1;return-1},getObjById:function(e,t){var n=null;for(var r=0,i;i=e[r++];){if(i.id==t){n=i;break}if(i.children){var n=this.getObjById(i.children,t);if(n)break}}return n},getTreeData:function(e){var e=$.extend(!0,[],e);for(var t=0,n;n=e[t++];){n.label=n.name;if(n.parentId){var r=this.getObjById(e,n.parentId);r.children||(r.children=[]),r.children.push(n),t-=1,e.splice(t,1)}}return this.appendNodeLevelAndSort(e),e},getAgentStructure:function(e){var e=$.extend(!0,[],e);for(var t=0,n;n=e[0].children[t++];)n.label!=="合作伙伴"&&e[0].children.splice(t-1,1);return e},getParentKeyNodeItem:function(e,t){var n=this.getObjById(e,t);if(!n)return undefined;var r=n.parentId;while(r){if(n.isKeyNode)return n;n=this.getObjById(e,r);if(!n)return undefined;r=n.parentId}return e[0]},getParentIds:function(e,t){var n=this.getObjById(e,t);if(n)var r=n.parentId;return r?r:undefined},appendNodeLevelAndSort:function(e){var t=[],n=1;e=this.pinyinSort(e,"name");for(var r=0,i;i=e[r++];)i.level=n,t.push(i);while(t.length){var s=t.splice(0,1)[0],o=s.children;if(o){o=this.pinyinSort(o,"name");for(var r=0,i;i=o[r++];)i.level=s.level+1,t.push(i)}}},getSalaryNode:function(e,t){var n=[],r=t.userInfo.hasAllRoles.salaryHR;for(var i=0,s;s=e[i++];)s.isKeyNode&&$.inArray(s.id,r)!=-1&&n.push(s);return n},getPunchCard:function(e){var t=[];for(var n=0,r;r=e[n++];)r.isPunchCard&&t.push(r);return t},isNodeSalaryHR:function(e){var n=t.userInfo.hasRoles.salaryHR;return $.inArray(e,n)!=-1?!0:!1},canManageNodeSalary:function(e){var n=t.userInfo.hasAllRoles.salaryHR;return $.inArray(e,n)!=-1?!0:!1},getUsernameFromSuggestion:function(e){return e?e.split(",")[1]:undefined},getNameFromSuggestion:function(e){return e?e.split(",")[0]:undefined},getShowUserName:function(e,t){return e&&t?t+","+e:e?e:t?e:n.EMPTY_VALUE},merge:function(e,t){var n=$.merge(e,t);return $.unique(n)},formatTime:function(e){var t=new Date(+e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},validateLast7Day:function(e,t){var n=new Date(t),r=new Date,i=n.getDate(),s=r.getDate(),o=n.getMonth(),u=r.getMonth();return o<u&&n<r?(alert(e+"不能早于当前月份"),!1):n<r&&s-i>7?(alert(e+"不能早于当前时间7天"),!1):!0},forbidFieldOfLabor:function(e,t,r){var i=n.FORBID_OF_LABOR_STAFF;for(var s=0,u;u=i[s++];)e[u]&&(e[u].forbid=t,t&&(u=="trafficSubsidy"||u=="mobileSubsidy"||u=="probationarySalary"?r[u]={inputVal:undefined,selectVal:o}:r[u]=undefined))},forbidFieldOfRegular:function(e,t,r){var i=n.FORBID_OF_REGULAR_STAFF;for(var s=0,u;u=i[s++];)e[u]&&(e[u].forbid=t,t&&(u=="probationarySalary"?r[u]={inputVal:undefined,selectVal:o}:r[u]=undefined))},setDefaultSocialBase:function(e,t,n){function i(e,t){e>r[t+"Max"]?n[t+"Base"]=r[t+"Max"]:e<r[t+"Min"]?n[t+"Base"]=r[t+"Min"]:n[t+"Base"]=e}var e=e||{},r=t;if(r.socialSecurityBySalary){var s=typeof e.salary=="undefined"?+n.probationarySalary.inputVal:+e.salary;i(s,"socialSecurity"),i(s,"endow"),i(s,"medical"),i(s,"unemploy"),i(s,"injury"),i(s,"maternity");return}n.socialSecurityBase=r.socialSecurityDefault||0,n.endowBase=r.socialSecurityDefault||0,n.medicalBase=r.socialSecurityDefault||0,n.unemployBase=r.socialSecurityDefault||0,n.injuryBase=r.socialSecurityDefault||0,n.maternityBase=r.socialSecurityDefault||0},setDefaultHouseBase:function(e,t,n){var e=e||{},r=t;if(r.houseFundBySalary){var i=typeof e.salary=="undefined"?+n.probationarySalary.inputVal:+e.salary;i>r.houseFundMax?n.houseFundBase=r.houseFundMax:i<r.houseFundMin?n.houseFundBase=r.houseFundMin:n.houseFundBase=i;return}n.houseFundBase=r.houseFundDefault},validateSocialAndHouseFundBase:function(e,t){function n(e,n,r){var i=t[n+"Max"],s=t[n+"Min"],o=e[n+"Base"];return o>i?(alert(r+"缴纳基数须小于该城市缴纳上限"+i+"元"),!1):o<s?(alert(r+"缴纳基数须大于该城市缴纳下限"+s+"元"),!1):!0}var r=t.needFiveBase;return n(e,"socialSecurity","社保")?n(e,"houseFund","公积金")?r&&!n(e,"endow","养老保险")?!1:r&&!n(e,"unemploy","失业保险")?!1:r&&!n(e,"medical","医疗保险")?!1:r&&!n(e,"injury","工伤保险")?!1:r&&!n(e,"maternity","生育保险")?!1:!0:!1:!1},diffDaysFromNow:function(e){var t=r(),n=r(e.getTime());return n.diff(t,"days")},inputEmpty:function(e){return typeof e=="undefined"||e===""?!0:!1},getInputInt:function(e){return typeof e=="undefined"?0:+e},fix:function(e){return this.toFixed(+e,2)},toFixed:function(e,t){var n=""+e,r=n.match(/\.\d*/g);if(!r)return e;if(r[0].slice(1).length<=t)return e;var i=Math.abs(e).toString(),s=e<0,o,u;return i=i.substr(0,i.indexOf(".")+t+2),o=i.charAt(i.length-1),i=i.substr(0,i.length-1),o>=5&&(u=Math.pow(10,i.length-i.indexOf(".")-1),i=(+i+1/u).toFixed(t)),i*(s?-1:1)},getShortStructureName:function(e,t){var n=e.indexOf(t),r="";return n!=-1?r=e.slice(n+t.length+1):r=e,r==""&&(r=e),r},pinyinSort:function(e,t){return t?e.sort(function(e,n){return e[t].localeCompare(n[t])}):e.sort(function(e,t){return e.localeCompare(t)})}}}])});