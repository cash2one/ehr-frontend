define(["require","../app"],function(e){var t=e("../app");t.factory("ajaxService",["$http","$rootScope","$q","$cacheFactory","loadingUtil","login",function(e,t,n,r,i,s){function a(t,r){var s=r.cache||!1,a=typeof r.asyn=="undefined"?!0:r.asyn,c=typeof r.showLoading=="undefined"?!0:r.showLoading,h=r.cacheTime,p=n.defer(),d=t+"--"+JSON.stringify(r),v=o[d]||null;if(v)var m=v.content,g=v.getTime;var y=l(g,h);if(s&&m&&y)f(m,r,p);else{c&&i.showLoading();if(a){var b={method:"POST",url:t,cache:s,data:r.data||{}};r.type&&r.type=="file"&&(b.transformRequest=angular.identity,b.headers={"Content-Type":undefined}),e(b).success(function(e){T(e)}).error(function(){x()})}else{var w=$.ajax({url:t,type:"post",data:r.data||{},async:!1});try{var E=$.parseJSON(w.responseText);T(E)}catch(S){x()}}function x(){u--,c&&u==0&&i.hideLoading(),alert("网络异常")}function T(e){u--,c&&u==0&&i.hideLoading(),f(e,r,p),s&&(o[d]={content:e,getTime:(new Date).getTime()})}}return p.promise}function f(e,t,n){e.status==200?n.resolve(e):n.reject(e),e.status==200?t.successHandler&&t.successHandler(e):e.status==500?alert("系统异常"):e.status==700?s.show():e.status==400||e.status==800?t.failHandler?t.failHandler(e,e.error.message):alert(e.error&&e.error.message||"未知错误("+(new Date).getTime()+")，请联系ehr@baijiahulian.com"):e.status==300?t.partSuccessHandler&&t.partSuccessHandler(e):e.status==0?window.location.reload():alert("unkonwn error")}function l(e,t){if(!t)return!0;var n=(new Date).getTime();return n-e>t?!1:!0}var o={},u=0;return{send:function(e,t){return u++,a(e,t)},clearCache:function(e){for(var t in o)t.indexOf(e)==0&&(o.key=null)}}}])});