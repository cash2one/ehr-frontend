define(["require","../../app","./inputOptions","module/config","module/codeConfig"],function(e){var t=e("../../app"),n=e("./inputOptions"),r=e("module/config"),i=e("module/codeConfig"),s={};t.controller("adminEditStructureCtrl",["$scope","adminRequest","$stateParams","localStorage","$state","util","$modalInstance","parentId","nodeId","hrRequest",function(e,t,i,s,o,u,a,f,l,c){function h(e,t){if(!e)return undefined;var n=[];for(var r=0,i;i=e[r++];)n.push(i[t]);return n.length?n:undefined}function p(t){var n=e[t],r=e[t+"Name"],i=[],s=n.length;for(var o=0;o<s;o++)i.push({userName:n[o],name:r[o]});return i}function d(){e.parendId=f,e.title="新建",f&&(e.isAdd=!0,e.showName=!0,e.isPunchCard=0),l&&(e.isEdit=!0,e.title="编辑",e.getStructureInfo()),e.inputOptions=n("editStructureForm",e),v(),g(),m()}function v(){c.getSocialSecurityCity().then(function(t){t.data.unshift(r.EMPTY),e.inputOptions.socialSecurityCity.items=t.data})}function m(){t.getLevelTemplate().then(function(t){t.data.unshift(r.EMPTY),e.inputOptions.levelTemplate.items=t.data})}function g(){t.getCalendarList().then(function(t){t.data.unshift(r.EMPTY),e.inputOptions.calendar.items=t.data})}e.save=function(n){if(!n.$valid)return;var r=u.getUsernameFromSuggestion(e.owner),i=u.getNameFromSuggestion(e.owner);if(e.punchDevice==""||e.punchDevice==null)e.punchDevice=undefined;var s={name:e.name,shortName:e.shortName,owner:r?[r]:[],ownerName:i?[i]:[],recruitHR:h(e.recruitHR,"userName"),recruitHRName:h(e.recruitHR,"name"),salaryHR:h(e.salaryHR,"userName"),salaryHRName:h(e.salaryHR,"name"),relationshipHR:h(e.relationshipHR,"userName"),relationshipHRName:h(e.relationshipHR,"name"),trainingHR:h(e.trainingHR,"userName"),trainingHRName:h(e.trainingHR,"name"),businessPartnerHR:h(e.businessPartnerHR,"userName"),businessPartnerHRName:h(e.businessPartnerHR,"name"),assetManager:h(e.assetManager,"userName"),assetManagerName:h(e.assetManager,"name"),itOwner:h(e.itOwner,"userName"),itOwnerName:h(e.itOwner,"name"),reception:h(e.reception,"userName"),receptionName:h(e.reception,"name"),punchDevice:e.punchDevice,isKeyNode:e.isKeyNode?1:0,isPunchCard:e.isPunchCard,socialSecurityCity:e.socialSecurityCity,levelTemplate:e.levelTemplate,calendar:e.calendar,mailSuffix:e.mailSuffix,taxLocal:e.taxLocal?1:0,isWelfareDefault:e.isWelfareDefault?1:0,isGroupNode:e.isGroupNode?1:0,mealSubsidy:e.mealSubsidy?+e.mealSubsidy:0,numberPrefix:e.numberPrefix,lowestSalary:e.lowestSalary};if(!s.isKeyNode)s.socialSecurityCity="",s.levelTemplate="",s.taxLocal=0,s.isWelfareDefault=0,s.mealSubsidy=0,s.isPunchCard=0,s.reception=[],s.receptionName=[],s.punchDevice=undefined;else{s.isPunchCard==0&&(s.reception=[],s.receptionName=[],s.punchDevice=undefined);if(!s.salaryHR){alert("请为工资结算结点配置薪酬HR");return}}var o=t.addStructure;e.isEdit&&(s.id=l,e.parentStructure.id&&(s.parentStructure=e.parentStructure.id,s.parentStructureName=e.parentStructure.name),o=t.modStructure),e.isAdd&&(s.parentStructure=f),o(s).then(function(e){info("添加成功"),a.dismiss({hadSuccess:!0})})},e.closeHandler=function(){a.dismiss({})},e.getStructureInfo=function(){t.getStuctureInfo({id:l}).then(function(t){var n=t.data;$.extend(!0,e,n),e.numberPrefix&&(e.inputOptions.numberPrefix.forbid=!0),e.owner=u.getShowUserName(e.owner[0],e.ownerName[0]),e.parentStructure={id:e.parentStructure,name:e.parentStructureName},e.isEdit&&l!=r.STRUCTURE_ROOT_ID&&(e.showParentStructure=!0,e.showName=!0),e.recruitHR=p("recruitHR"),e.salaryHR=p("salaryHR"),e.relationshipHR=p("relationshipHR"),e.trainingHR=p("trainingHR"),e.businessPartnerHR=p("businessPartnerHR"),e.assetManager=p("assetManager"),e.itOwner=p("itOwner"),e.reception=p("reception")})},d()}])});