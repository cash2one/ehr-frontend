define(["require","../app","module/config"],function(e){var t=e("../app"),n=e("module/config");t.controller("structureCtrl",["$scope","$stateParams","util","adminRequest","hrRequest","$modal","adminUtil",function(e,t,r,i,s,o,u){function a(){e.expandedNodes=r.merge([e.selectedNode],[]),e.expandedNodes=r.merge([e.selectedNode],f(e.selectedNode))}function f(e){var t=e.children,n=[];if(t)for(var r=0,e;e=t[r++];)n.push(e);return n}e.treeData=[],e.expandedNodes=[],e.treeOptions={injectClasses:{li:"node-header"},allowDeselect:!1},e.hasParentNode=!1,e.viewNode=function(e){},e.addNode=function(t){u.addStructure(t.id,function(t){t.hadSuccess&&e.getStructureList()})},e.editNode=function(t){u.editStructure(t.id,function(t){t.hadSuccess&&(e.getStructureList(),e.getNodeInfo(e.selectedNode.id))})},e.delNode=function(t){if(t.isKeyNode){alert("结算结点不能隐藏，如需隐藏，请先设置为非结算结点");return}confirm("确认要将该节点设置为隐藏吗？",function(){i.delStucture({number:t.id}).then(function(){info("设置成功"),e.getStructureList()})})},e.enableNode=function(t){confirm("确认要将该节点恢复使用吗？",function(){i.enableStucture({number:t.id}).then(function(){info("设置成功"),e.getStructureList()})})},e.onNodeSelect=function(t){e.getNodeInfo(t.id),t.id==n.STRUCTURE_ROOT_ID?e.hasParentNode=!1:e.hasParentNode=!0},e.getNodeInfo=function(t){i.getStuctureInfo({id:t}).then(function(t){e.info=t.data})},e.getStructureList=function(){i.getStructure().then(function(t){e.treeData=r.getTreeData(t.data),e.selectedNode||(e.selectedNode=e.treeData[0],e.getNodeInfo(e.selectedNode.id),a())})},e.getStructureList(),setTimeout(function(){$("treecontrol").find("ul").find("li").eq(0).css({"border-left":"0px"})},300),$(window).scroll(function(){var e=$(window).scrollTop();e>=110?$("#structure-info").css({position:"fixed",top:"5px",right:"33px",bottom:0,overflow:"auto"}):$("#structure-info").css({position:"static"})})}])});