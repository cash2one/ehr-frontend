define(["require","../app","module/config"],function(e){var t=e("../app"),n=e("module/config");t.controller("permissionCtrl",["$scope","$stateParams","localStorage","adminRequest","hrRequest",function(e,t,n,r,i){e.number=n.get("number"),e.getAuth=function(){r.getAuth({number:e.number}).then(function(t){var n=t.data.roleTypes;e.roleType=n?n.split(","):[];for(var r=0;r<e.roleType.length;r++)e[e.roleType[r]]=!0;var i=t.data.manageRange||[];for(var r=0,s;s=i[r++];){var o=s.departmentIds.split(",");for(var u=0;u<o.length;u++)o[u]=+o[u];s.departmentIds=o}e.manageRange=i})},e.departmentsSelectOptions={items:[]},e.companyAddClick=function(){e.isAdding=!0},e.getCompany=function(){i.getCompany().then(function(t){e.add.companys=t.data})},e.companyChangeHandler=function(){i.getDepartment({company:e.add.company}).then(function(t){e.departmentsSelectOptions.items=t.data,e.add.departments=[]})},e.add={onCancel:function(){e.isAdding=!1},onSave:function(t){if(!t.$valid)return;e.manageRange.push({companyId:e.add.company,companyName:e.getCompanyName(e.add.company),departmentIds:e.add.departments,departmentNames:e.getDepartmentNames(e.add.departments)}),e.isAdding=!1,e.add.company=undefined,e.add.departments=[]}},e.getCompanyName=function(t){for(var n=0,r;r=e.add.companys[n++];)if(r.id==t)return r.name},e.getDepartmentNames=function(t){var n=[],r=e.departmentsSelectOptions.items;for(var i=0,s;s=r[i++];)$.inArray(s.id,t)!=-1&&n.push(s.name);return n.join(",")},e.saveAuth=function(){function n(e){var t=[];for(var n=0,r;r=e[n++];){if(!r.companyId)continue;t.push({companyId:r.companyId,departmentIds:r.departmentIds.join(",")})}return t}var t=[];e.HRBP&&t.push("HRBP"),e.ZPHR&&t.push("ZPHR"),e.XCHR&&t.push("XCHR"),e.GXHR&&t.push("GXHR"),e.PXHR&&t.push("PXHR");var i={number:+e.number,roleTypes:t.join(","),manageRange:n(e.manageRange)};r.modAuth(i).then(function(e){info("修改成功")})},e.getCompany(),e.getAuth()}])});