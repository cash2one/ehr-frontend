define(["require","../app","module/config","module/hr/config","module/codeConfig"],function(e){var t=e("../app");t.controller("staffInfoCtrl",["$scope","hrRequest","$stateParams","localStorage","$state","authUtil","hrUtil","commonInfo","hrOptUtil",function(t,n,r,i,s,o,u,a,f){function d(){v(),m(),t.$on("$stateChangeStart",function(e,n){n.name=="subordinate.self.monthSalary"?(t.showLeaveBtn=!1,t.showOptArea=!1):(t.commonInfo.status!=p.LEAVED&&t.commonInfo.status!=p.TO_LEAVE&&(t.showLeaveBtn=!0),t.showOptArea=!0,!t.$root.userInfo.isAgent&&t.isAgent&&(t.showOptArea=!1))})}function v(){if(s.includes("subordinate.self"))t.entryName="subordinate.self",t.isSelfView=!0;else if(s.includes("subordinate.info"))t.entryName="subordinate.info",t.isLeaderView=!0,t.pageTitle="下属信息",t.$emit("viewOtherStaffDetail","");else if(s.includes("admin.staffInfo"))t.entryName="admin.staffInfo",t.pageTitle="员工信息",t.showOptArea=!1;else{var e=s.current.name.split(".");u.initEntryHRType(t),t.isFromRelationshipHR&&(t.canSeeInitInfo=!0),t.isHRView=!0,t.$emit("viewOtherStaffDetail","")}t.canReadBaseInfo=!0,t.canReadWorkInfo=!0,t.canReadSalaryInfo=!0,t.canReadMonthSalary=!1,t.canReadSecretInfo=!0,t.canReadChangeInfo=!0,t.canReadLeaveInfo=!1,t.canReadWorkTargetInfo=!1,t.canReadFormalApplyInfo=!1,t.entryName=="subordinate.self"?(t.canReadLeaveInfo=!1,t.canReadMonthSalary=!0):t.entryName=="subordinate.info"?t.canReadSecretInfo=!1:t.entryName=="admin.staffInfo"?t.canReadLeaveInfo=!0:(t.canReadBaseInfo=!0,t.canReadWorkInfo=!0,t.canReadSalaryInfo=t.isFromHRBP||t.isFromSalaryHR,t.canReadMonthSalary=t.canReadSalaryInfo,t.canReadSecretInfo=t.isFromHRBP||t.isFromRelationshipHR,t.canReadChangeInfo=!0);var n=t.commonInfo.status;(t.isFromRelationshipHR||t.isFromHRBP)&&t.commonInfo.dimissionStatus!=c.DIMISSION_STATUS.NOT_APPLY&&(t.canReadLeaveInfo=!0);var r=t.commonInfo,n=r.status;t.detail=r.detail,n==p.TO_JOIN&&t.isFromRelationshipHR&&t.isHRView?t.showJoinBtn=!0:t.showJoinBtn=!1,t.commonInfo.forbidStatus&&(t.curForbidBtnName="解冻账号"),t.commonInfo.type==21&&(t.isAgent=1)}function m(){y(),g()}function g(){var e=t.commonInfo.applyList,n=h.APPLY_CODE;e.length!=0&&(t.disableTransFullBtn=!0,t.disableStructureChangeBtn=!0,t.disableSalaryChangeBtn=!0,t.disbaleLeaveBtn=!0,t.disbaleMultipleBtn=!0,t.disableProbationChangeBtn=!0,t.disableFormalApplyBtn=!0,t.disableWorkTarget=!0)}function y(){var e=t.commonInfo.type,n=h.TYPE_CODE,r=s.includes("hr.businessPartnerHR-staffInfo"),i=s.includes("hr.relationshipHR-staffInfo"),o=s.includes("hr.salaryHR-staffInfo");(e==n.INTERNS||e==n.LABOR)&&(r||t.entryName=="subordinate.info")&&(t.showTransFullBtn=!0);if(t.entryName=="subordinate.info"||r||i)t.showStructureChangeBtn=!0;if(t.entryName=="subordinate.info"||r)t.showMultipleBtn=!0;if(t.entryName=="subordinate.info"||r||o)t.showSalaryChangeBtn=!0;r&&(t.showForbidBtn=!0),t.entryName=="subordinate.info"&&t.commonInfo.probationaryStatus===1&&t.commonInfo.type===1&&(t.showProbationChangeBtn=!0);if(t.commonInfo.type===1){t.commonInfo.formalApplyStatus===1&&t.entryName=="subordinate.self"&&(t.showFormalApplyBtn=!0),t.commonInfo.workTargetStatus===1&&t.entryName=="subordinate.self"&&(t.showWorkTargetBtn=!0);if(r||i||t.entryName=="subordinate.info"||t.entryName=="subordinate.self"||t.entryName=="admin.staffInfo")t.canReadFormalApplyInfo=!0,t.canReadWorkTargetInfo=!0}if(r||i||t.entryName=="subordinate.info"||t.entryName=="subordinate.self")s.includes("subordinate.self.monthSalary")?(t.showLeaveBtn=!1,t.showOptArea=!1):(t.showLeaveBtn=!0,t.showOptArea=!0);if(t.commonInfo.status==p.ABANDED||t.commonInfo.status==p.LEAVED||t.commonInfo.status==p.TO_JOIN)t.showOptArea=!1;if(t.commonInfo.status==p.LEAVED||t.commonInfo.status==p.TO_LEAVE)t.showLeaveBtn=!1,t.showStructureChangeBtn=!1;!t.$root.userInfo.isAgent&&t.isAgent&&(t.showOptArea=!1)}function b(){f.changeProbation(t.number,function(e){e.hadSuccess&&L()})}function w(){f.writeWorkTarget(t.number,function(e){e.hadSuccess&&L()})}function E(){f.formalApply(t.number,function(e){e.hadSuccess&&L()})}function S(){f.transFullTime(t.number,function(e){e.hadSuccess&&L()})}function x(){f.changeStructure(t.number,t.isFromHRBP,function(e){e.hadSuccess&&L()})}function T(){f.changeSalary(t.number,function(e){e.hadSuccess&&L()})}function N(){f.leave(t.number,function(e){e.hadSuccess&&L()})}function C(){f.multipleChange(t.number,t.isFromHRBP,function(e){e.hadSuccess&&L()})}function k(){var e=1;t.curForbidBtnName=="解冻账号"&&(e=0),confirm("您确认要"+(e?"冻结":"解冻")+"此账号吗",function(){n.forbidAccount({forbid:e,number:t.number}).then(function(){info("操作成功"),e?t.curForbidBtnName="解冻账号":t.curForbidBtnName="冻结账号"})})}function L(){t.disableProbationChangeBtn=!0,t.disableTransFullBtn=!0,t.disableStructureChangeBtn=!0,t.disableSalaryChangeBtn=!0,t.disbaleLeaveBtn=!0,t.disbaleMultipleBtn=!0,t.disableWorkTargetBtn=!0,t.disableFormalApplyBtn=!0}function A(){t.hasGetJobNumber=!0,n.getJobNumber({number:t.number}).then(function(e){t.commonInfo.displayNumber=e.displayNumber},function(){t.hasGetJobNumber=!1})}t.commonInfo=a.data;var l=e("module/config"),c=e("module/hr/config"),h=e("module/codeConfig");t.number=i.get("number"),t.pageTitle="员工信息",t.canSeeInitInfo=!1,t.onTransFull=S,t.onChangeStructure=x,t.onChangeSalary=T,t.onLeave=N,t.onMultiple=C,t.onForbid=k,t.onWriteWorkTarget=w,t.onFormalApply=E,t.onChangeProbation=b,t.showOptArea=!0,t.showForbidBtn=!1,t.curForbidBtnName="冻结账号",t.getJobNumber=A,t.hasGetJobNumber=t.commonInfo.displayNumber;var p=h.STAFF_STATUS_CODE;t.joinWorkClick=function(){u.joinWork(t.number).then(function(e){t.showJoinBtn=!1,t.commonInfo.status=p.HAS_JOINED,t.showOptArea=!0,t.$broadcast("hasEntered","")})},t.initInfoClick=function(){u.showInitInfo(t.number)},d()}])});