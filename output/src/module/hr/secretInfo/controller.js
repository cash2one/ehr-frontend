define(["require","../app","./options","./familyMemberInfo","module/config","module/codeConfig"],function(e){var t=e("../app"),n=e("./options"),r=e("./familyMemberInfo"),i=e("module/config");t.controller("hrSecretInfoCtrl",["$scope","hrRequest","$stateParams","localStorage","$state","authUtil","hrUtil",function(t,s,o,u,a,f,l){function h(e){var n=t.familyList;for(var r=0,i;i=n[r++];)i.disable=!e;t.isReadOnly2=!1}function p(){t.getSecretInfo(),l.initCommonInfo(t),t.secretOptions=n("secretInfoForm",t),t.canEditSecretInfo=!1,t.isReadOnly=!0,t.entryName=="subordinate.info.secretInfo"?t.canEditSecretInfo=!1:t.entryName=="subordinate.self.secretInfo"?t.canEditSecretInfo=!0:(l.initEntryHRType(t),t.isFromRelationshipHR&&(t.canEditSecretInfo=!0),t.isFromHRBP&&(t.canEditSecretInfo=!0)),t.isReadOnly&&t.disbaleSecretInput(),t.getFamilyMember(),y()}function d(){t.enableSecretInput(),t.isReadOnly=!1}function v(){h(!0),t.isReadOnly2=!1}function m(){t.isReadOnly=!0,t.disbaleSecretInput(),t.getSecretInfo()}function g(){h(!1),t.isReadOnly2=!0}function y(){t.canEditSecretInfo&&s.getBank().then(function(e){e.data.unshift(i.EMPTY),t.secretOptions.bank.items=e.data})}t.number=u.get("number");var c=e("module/codeConfig");t.entryName=a.current.name,t.familyMemberOptions=r("familyMemberAddForm"),t.disbaleSecretInput=function(){l.disableOptions(t.secretOptions);var e=t.familyList;if(e)for(var n=0,r;r=e[n++];)r.disable=!0},t.enableSecretInput=function(){l.enableOptions(t.secretOptions)},t.isReadOnly=!0,t.isReadOnly2=!0,t.onEdit=d,t.onEditPart2=v,t.cancelPart1=m,t.cancelPart2=g,t.getSecretInfo=function(){s.getStaffSecretInfo({number:t.number}).then(function(e){var n=e.data;t.cardNum=n.cardNum,t.emergContactMobile=n.emergContactMobile,t.personalEmail=n.personalEmail,t.emergContact=n.emergContact,t.address=n.address,t.address=n.address,t.bank=n.bank,t.filePlace=n.filePlace,t.secretOptions.bank.displayValue=n.bankName})},t.getFamilyMember=function(){s.getFamilyMember({number:t.number}).then(function(e){for(var n=0,r;r=e.data[n++];)t.isReadOnly2&&(r.disable=!0),r.mobile=+r.mobile;t.familyList=e.data})},t.familyMemberAdd={addClick:function(){t.addingFamilyMember=!0},onCancel:function(){var e=this;t.addingFamilyMember=!1,e.clearInfo()},clearInfo:function(){t.familyMemberAdd.name=undefined,t.familyMemberAdd.title=undefined,t.familyMemberAdd.birthday=undefined,t.familyMemberAdd.company=undefined,t.familyMemberAdd.position=undefined,t.familyMemberAdd.mobile=undefined},onSave:function(e){e.$submitted=!0;var n=this;if(!e.$valid)return;s.addFamilyMember({number:t.number,name:t.familyMemberAdd.name,title:t.familyMemberAdd.title,birthday:t.familyMemberAdd.birthday&&t.familyMemberAdd.birthday.getTime(),company:t.familyMemberAdd.company,position:t.familyMemberAdd.position,mobile:t.familyMemberAdd.mobile}).then(function(r){info("添加成功"),t.addingFamilyMember=!1,t.getFamilyMember(),e.$submitted=!1,n.clearInfo()})}},t.saveSecretInfo=function(e){if(!e.$valid)return;var n={number:t.number,cardNum:t.cardNum,personalEmail:t.personalEmail,emergContact:t.emergContact,emergContactMobile:t.emergContactMobile,address:t.address,filePlace:t.filePlace,bank:t.bank};s.saveSecretInfo(n).then(function(){info("保存成功"),t.isReadOnly=!0,t.disbaleSecretInput(),t.getSecretInfo()})},p(),t.$on("hasEntered",function(){t.canEditSecretInfo=!1})}])});