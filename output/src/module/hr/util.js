define(["require","./app","module/config","module/codeConfig","module/nameConfig","./config"],function(e){var t=e("./app"),n=e("module/config"),r=e("module/codeConfig"),i=e("module/nameConfig"),s=e("./config");t.factory("hrUtil",["$modal","authUtil","$q","hrRequest","util","$state","bigDecimal",function(e,t,o,u,a,f,l){var c=n.SALARY_TYPE[1].id,h=l.add,p=l.minus,d=l.multiply,v=l.div;return{showInitInfo:function(t){e.open({templateUrl:"src/module/hr/initInfo/tpl.html",controller:"hrInitInfoCtrl",resolve:{number:function(){return t}}})},showAssetAddInfo:function(t,n){var r=e.open({templateUrl:"src/module/hr/opt/addAssetId/tpl.html",controller:"hrOptAddAssetIdCtrl",resolve:{item:function(){return t}}});r.result.then(function(){},function(e){n(e)})},getSalary:function(e){return typeof e.inputVal=="undefined"?undefined:{value:e.inputVal,salaryType:e.selectVal}},transSalaryInfo:function(e){return{inputVal:e.value,selectVal:e.salaryType||c}},getObjectQueryString:function(e){var t=[];for(var n in e){if(n=="pageDto")continue;e.hasOwnProperty(n)&&e[n]&&(e[n]instanceof Date?t.push(n+"="+e[n].getTime()):t.push(n+"="+e[n]))}return t.join("&")},getFirstDayOfMonth:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1;return new Date(t+"-"+n+"-"+"01")},canEditBaseInfo:function(){return t.isHRBP()?!0:!1},canEditWorkInfo:function(){return t.isHRBP()?!0:!1},canEditSalaryInfo:function(){return t.isHRBP()?!0:!1},canEditSecretInfo:function(){return t.isHRBP()||t.isRelationshipHR()?!0:!1},canEditLeaveInfo:function(){return t.isHRBP()||t.isRelationshipHR()?!0:!1},canReadBaseInfo:function(){return t.isHRBP()||t.isRelationshipHR()||t.isSalaryHR()||t.isTrainingHR()?!0:!1},canReadChangeInfo:function(){return t.isHRBP()||t.isRelationshipHR()||t.isSalaryHR()||t.isTrainingHR()?!0:!1},canReadWorkInfo:function(){return t.isHRBP()||t.isRelationshipHR()||t.isSalaryHR()||t.isTrainingHR()?!0:!1},canReadSalaryInfo:function(){return t.isHRBP()||t.isSalaryHR()?!0:!1},canReadSecretInfo:function(){return t.isRelationshipHR()?!0:!1},canReadLeaveInfo:function(){return t.isHRBP()||t.isRelationshipHR()?!0:!1},disableOptions:function(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].disable=!0)},enableOptions:function(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].disable=!1)},getValueByKey:function(e,t,n){for(var r=0,i;i=e[r++];)if(i.id==t)return i[n];return undefined},isBranchCompany:function(e){return e.indexOf(s.BRANCH_COMPANY_FLAG)>=0?!0:!1},needUploadLimitAgreement:function(e,t,i,s){if(this.isBranchCompany(e)){var o=t.match(/\d$/),u=t.match(/^[a-zA-Z]/);return u==n.LEVEL_NAME.M?!0:u==n.LEVEL_NAME.A&&o>4?!0:!1}return i==r.TYPE_CODE.REGULAR?!0:!1},setFieldRequired:function(e,t){e.required=t},initCommonInfo:function(e){e.staffInfo=e.commonInfo,e.staffType=e.commonInfo.type},joinWork:function(e){var t=this,n=o.defer();return confirm("确认该员工入职手续已经办完，可以入职？",function(){u.modStaffStatus({number:+e,status:r.STAFF_STATUS_CODE.HAS_JOINED}).then(function(e){info("入职成功"),n.resolve(e)})}),n.promise},getFieldSet:function(e,t){var n=[];for(var r=0,i;i=e[r++];)i[t]&&n.push(i[t]);return n},getLeaveReasonName:function(e,t){var n=i.LEAVE_REASON[e]||"";if(e)var r=i.LEAVE_DETAIL_REASON[e][t]||"";else var r="";return n+"-"+r},initEntryHRType:function(e){f.includes("subordinate.self.salaryInfo")&&(e.isFromSelf=!0),f.includes("hr.relationshipHR-staffInfo")&&(e.isFromRelationshipHR=!0),f.includes("hr.businessPartnerHR-staffInfo")&&(e.canEditBaseInfo=!0,e.isFromHRBP=!0),f.includes("hr.trainingHR-staffInfo")&&(e.isFromTrainingHR=!0),f.includes("hr.salaryHR-staffInfo")&&(e.isFromSalaryHR=!0)},getPerformSalaryHtml:function(e,t){var n="";for(var r=0;r<e.length;r++){var s="",o="";if(e[r].accountInfo.businessUnit){s=i.BUSINESS_UNIT[e[r].accountInfo.businessUnit];var u="",a="";e[r].accountInfo.businessUnit==3?(u='        <td rowspan="4">牌级佣金:</td>\n        <td rowspan="4">'+this.performDataHandle(e[r].commissionData.levelCommission)+"</td>\n",a="        <td>成交手佣金:</td>\n        <td>"+this.performDataHandle(e[r].commissionData.receiverCommission)+"</td>\n"):u='        <td rowspan="5">牌级佣金:</td>\n        <td rowspan="5">'+this.performDataHandle(e[r].commissionData.levelCommission)+"</td>\n"}e[r].accountInfo.role==7?(e[r].statData.lastLevel&&(o=i.ACHIEVEMENT_LEVEL[e[r].statData.lastLevel]),n+='<table class="table table-bordered">\n    <tr>\n        <td>绩效部门:</td>\n        <td>'+s+"</td>\n"+u+"    </tr>\n"+"    <tr>\n"+"        <td>上月牌级</td>\n"+"        <td>"+o+"</td>\n"+"    </tr>\n"+"    <tr>\n"+"        <td>新签业绩</td>\n"+"        <td>"+this.performDataHandle(e[r].statData.newAchievement)+"</td>\n"+"    </tr>\n"+"    <tr>\n"+"        <td>续签业绩</td>\n"+"        <td>"+this.performDataHandle(e[r].statData.renewAchievement)+"</td>\n"+"    </tr>\n"+"    <tr>\n"+"        <td>百家云业绩:</td>\n"+"        <td>"+this.performDataHandle(e[r].statData.cloudAchievement)+"</td>\n"+a+"    </tr>\n"+"    <tr>\n"+"        <td>百家云退款业绩</td>\n"+"        <td>"+this.performDataHandle(e[r].statData.cloudRefundMoney)+"</td>\n"+"        <td>百家云佣金:</td>\n"+"        <td>"+this.performDataHandle(e[r].commissionData.cloudCommission)+"</td>\n"+"    </tr>\n"+"    <tr>\n"+"        <td>退款业绩</td>\n"+"        <td>"+this.performDataHandle(e[r].statData.refundAchievement)+"</td>\n"+"        <td>退款佣金:</td>\n"+"        <td>"+this.performDataHandle(e[r].commissionData.refundCommission)+"</td>\n"+"    </tr>\n"+"    <tr>\n"+"        <td></td>\n"+"        <td></td>\n"+"        <td>合计:</td>\n"+"        <td>￥&nbsp;"+t.toFixed(2)+"</td>\n"+"    </tr>\n"+"</table><br>\n"):(n+='<table class="table table-bordered">\n    <tr>\n        <td>绩效部门:</td>\n        <td>'+s+"</td>\n"+"        <td>主管佣金:</td>\n"+"        <td>"+this.performDataHandle(e[r].commissionData.supervisorCommission)+"</td>\n"+"     </tr>\n",e[r].accountInfo.businessUnit==3?n+="     <tr>\n        <td>成交手佣金:</td>\n        <td>"+this.performDataHandle(e[r].commissionData.supervisorReceiverCommission)+"</td>\n"+"        <td>百家云佣金:</td>\n"+"        <td>"+this.performDataHandle(e[r].commissionData.cloudCommission)+"</td>\n"+"     </tr>\n"+"     <tr>\n"+"        <td></td>\n"+"        <td></td>\n"+"        <td>总佣金:</td>\n"+"        <td>"+this.performDataHandle(e[r].commissionData.actualSupervisorCommission)+"</td>\n"+"     </tr>\n":n+="     <tr>\n        <td>百家云佣金:</td>\n        <td>"+this.performDataHandle(e[r].commissionData.cloudCommission)+"</td>\n"+"        <td>总佣金:</td>\n"+"        <td>"+this.performDataHandle(e[r].commissionData.actualSupervisorCommission)+"</td>\n"+"     </tr>\n",n+="</table><br>\n")}return n},performDataHandle:function(e){return e===0?"￥&nbsp;"+v(e,100).toFixed(2):e?"￥&nbsp;"+v(e,100).toFixed(2):""}}}])});