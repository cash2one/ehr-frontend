define(["require","../app","./colsConfig"],function(e){function r(e,t,r,i){function s(){t.getStructure().then(function(t){e.structureList=r.getPunchCard(t.data)})}function o(){if(!e.query.structure){alert("请选择组织架构");return}if(!e.query.startDate||!e.query.endDate){alert("请选择时间");return}if(e.query.startDate>=e.query.endDate){alert("结束时间要大于开始时间");return}var t={pageDto:{pageNum:e.currentPage||1,pageSize:e.pageSize},structure:e.query.structure,startTs:+(new Date(e.query.startDate)),endTs:+(new Date(e.query.endDate))},n=$.trim(e.query.name);n.length&&n.indexOf(",")!==-1&&(t.userName=$.trim(n.split(",")[1])),i.getCardRecord(t).then(function(n){e.tableOptions.data=n.data,e.tableOptions.totalCount=n.pageDto&&n.pageDto.count||0,e.exportUrl=u(t)})}function u(e){return"/EXPORT/cardRecord/list.json?"+a(e)}function a(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&n!="pageDto"&&t.push(n+"="+e[n]);return t.push("fields=name,number,day,calendar,weekend,firstPunch,lastPunch,totalTime,reason"),t.join("&")}function f(){e.pageSize=20,e.query={},e.tableOptions={data:[],canSelect:!1,totalCount:0,cols:n(e),pageSize:e.pageSize,onPageChange:function(t){e.currentPage=t,o()},selectedItems:[]}}function l(){e.onSearch=o}function c(){f(),l(),s()}c()}var t=e("../app"),n=e("./colsConfig");t.controller("attendceRecordCtrl",r),r.$inject=["$scope","adminRequest","util","hrRequest"]});