define(["require","../app","../config","../fieldNameConfig","../fieldFilterConfig"],function(e){function s(e,t,s,o,u,a,f,l){function d(){g(),y()}function v(){var t="";e.approveResult==n.STATUS_CODE.TO_EXCUTE?t="确认通过该申请？":t="确认拒绝该申请？",confirm(t,m)}function m(){s.handleApply({approveList:[{id:c,result:e.approveResult,detail:e.detail}]}).then(function(){info("提交成功"),e.refreshApplyNum(),e.showOptArea=!1,y(),$("#apply-opt-detail-close",window.parent.document).click()})}function g(){console.log(p),/apply\.detail\.\w*-?staffEnter/g.test(p)?e.title="新员工入职":/apply\.detail\.\w*-?salary/g.test(p)?e.title="薪酬岗位调整":/apply\.detail\.\w*-?structure/g.test(p)?e.title="人事调动":/apply\.detail\.\w*-?multiple/g.test(p)?e.title="综合审批":/apply\.detail\.\w*-?\w*\.?offerInfo/g.test(p)?e.title="offer变更":/apply\.detail\.\w*-?leave/g.test(p)?e.title="员工离职":/apply\.detail\.\w*-?transFullMember/g.test(p)?e.title="实习/劳务转正式":/apply\.detail\.\w*-?workTarget/g.test(p)?e.title="试用期工作目标":/apply\.detail\.\w*-?formalApply/g.test(p)?e.title="试用期员工转正申请":/apply\.detail\.\w*-?agentEnter/g.test(p)?e.title="新员工入职":/apply\.detail\.\w*-?agentRejoin/g.test(p)?e.title="员工再入职":/apply\.detail\.\w*-?agentStructure/g.test(p)?e.title="人事调动":/apply\.detail\.\w*-?agentLeave/g.test(p)&&(e.title="员工离职")}function y(){var n=t.params.applyId;s.getApplyDetail({id:n}).then(function(t){e.applyInfo=t.data;if(S()||x()||T())e.showOptArea=!1;e.number=e.applyInfo.number,e.applyInfo.contentAfter=JSON.parse(e.applyInfo.contentAfter||"{}"),e.applyInfo.contentBefore=JSON.parse(e.applyInfo.contentBefore||"{}"),e.contentAfter=e.applyInfo.contentAfter,e.contentAfter.reason&&(e.contentAfter.reasonName=f.getLeaveReasonName(e.contentAfter.reason,e.contentAfter.detailReason));if(p.indexOf("staffEnter")!=-1||p.indexOf("offerChange.offerInfo")!=-1||p.indexOf("agentEnter")!=-1||p.indexOf("agentRejoin")!=-1)e.offerInfos=e.applyInfo.contentAfter,b();e.offerInfos&&e.offerInfos.socialSecurityCity&&w(e.offerInfos.socialSecurityCity),E()})}function b(){l.getStuctureStaffCount({structure:e.offerInfos.structure}).then(function(t){e.headCount=t.data;if(e.userInfo.isAgent){var n=e.offerInfos.structureName.split("-");e.structureName=n[n.length-1],e.headCount.length<2?e.agentCount=0:e.agentCount=e.headCount[1].regularCount}})}function w(t){o.getSocialSecurityCity({socialSecurityCity:t}).then(function(t){h=t.data[0],e.needFiveBase=h.needFiveBase})}function E(){e.changeList=[];var t=e.applyInfo,n=u.getChangedValue(t.contentBefore,t.contentAfter),s=r,o=i;for(var f in n)if(n.hasOwnProperty(f)&&s[f]){var l=n[f][1],c=n[f][0];if(o[f]){var h=o[f].split(":"),p=$.extend(!0,[],h),d=a(h[0]);p[0]=l,l=d.apply(undefined,p),p[0]=c,c=d.apply(undefined,p)}e.changeList.push({field:f,newVal:l,oldVal:c,fieldName:s[f]})}}function S(){var e=p.split(".")[2];return e.indexOf("finished-")!=-1||e.indexOf("modalFinished-")!=-1?!0:!1}function x(){var e=p.split(".")[2];return e.indexOf("my-")!=-1||e.indexOf("modalMy-")!=-1?!0:!1}function T(){var t=e.applyInfo.handleList,n=e.userInfo.userName;for(var r=0,i;i=t[r++];)if(n==i.userName&&(i.status==e.statusCode.PASS||i.status==e.statusCode.REJECT))return!0;return!1}var c=t.params.applyId;e.applyInfo={},e.onSubmit=v,e.approveResult=n.STATUS_CODE.TO_EXCUTE,e.statusCode=n.STATUS_CODE,e.title="",e.changeList=[],e.showOptArea=!0;var h={},p=t.current.name;d()}var t=e("../app"),n=e("../config"),r=e("../fieldNameConfig"),i=e("../fieldFilterConfig");t.controller("applyDetailCtrl",s),s.$inject=["$scope","$state","applyRequest","hrRequest","applyUtil","$filter","hrUtil","adminRequest"]});