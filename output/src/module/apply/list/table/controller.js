define(["require","../../app","../../config","module/config","module/codeConfig"],function(e){var t=e("../../app"),n=e("../../config"),r=e("module/config"),i=e("module/codeConfig");t.controller("applyListTableCtrl",["$scope","applyRequest","$state","applyListTableColsConfig","localStorage","applyOptUtil",function(e,t,s,o,u,a){function l(){E(),c()}function c(){switch(e.nav){case"toHandle":e.showPassBtn=!0,e.showRejectBtn=!0,e.showCancelBtn=!1;break;case"hasHandled":e.showPassBtn=!1,e.showRejectBtn=!1,e.showCancelBtn=!1;break;case"promoteMyself":e.showPassBtn=!1,e.showRejectBtn=!1,e.showCancelBtn=!0}}function h(){var t=i.APPLY_CODE;return e.subNav=="staffEnter"?t.STAFF_ENTER:e.subNav=="rejoin"?t.REJOIN:e.subNav=="leave"?t.LEAVE:e.subNav=="workInfo"?t.SALARY_INFO:e.subNav=="structure"?t.STRUCTURE:e.subNav=="transFullMember"?t.TRANS_FULL_MEMBER:e.subNav=="multiple"?t.MULTIPLE:e.subNav=="workTarget"?t.WORK_TARGET:e.subNav=="formalApply"?t.FORMAL_APPLY:e.subNav=="agentEnter"?t.AGENT_ENTER:e.subNav=="agentRejoin"?t.AGENT_REJOIN:e.subNav=="agentStructure"?t.AGENT_STRUCTURE:e.subNav=="agentLeave"?t.AGENT_LEAVE:undefined}function p(e){var t=n.TAB_CODE;if(e=="toHandle")return t.TO_HANDLE;if(e=="hasHandled")return t.HAS_HANDLED;if(e=="promoteMyself")return t.PROMOTE_MYSELF}function d(){var t=e.tableOptions.selectedItems;confirm("确认通过选中的"+t.length+"个审批吗？",function(){y("agree",t)})}function v(e){confirm("确认通过该审批吗？",function(){y("agree",[e])})}function m(){var t=e.tableOptions.selectedItems;confirm("确认拒绝选中的"+t.length+"个审批吗？",function(){y("reject",t)})}function g(e){confirm("确认拒绝该审批吗？",function(){y("reject",[e])})}function y(r,i){var i=i,s=[],o=n.HANDLE_RESULT.AGREE;r=="reject"&&(o=n.HANDLE_RESULT.REJECT);for(var u=0,a;a=i[u++];)s.push({id:a.id,result:o});t.handleApply({approveList:s}).then(function(){info("操作成功"),E(),e.tableOptions.selectedItems=[],e.getCountInfo(),e.refreshApplyNum()})}function b(t){u.set("number",t.editedNumber||0);var n=i.APPLY_CODE,r=e.nav,o="modal";r=="promoteMyself"&&(o="modalMy-"),r=="hasHandled"&&(o="modalFinished-");var f="";switch(t.type){case n.STAFF_ENTER:f=s.href("apply.detail."+o+"staffEnter",{applyId:t.id});break;case n.REJOIN:f=s.href("apply.detail."+o+"staffEnter",{applyId:t.id});break;case n.LEAVE:f=s.href("apply.detail."+o+"leave",{applyId:t.id});break;case n.MULTIPLE:f=s.href("apply.detail."+o+"multiple",{applyId:t.id});break;case n.SALARY_INFO:f=s.href("apply.detail."+o+"salary",{applyId:t.id});break;case n.STRUCTURE:f=s.href("apply.detail."+o+"structure",{applyId:t.id});break;case n.TRANS_FULL_MEMBER:f=s.href("apply.detail."+o+"transFullMember",{applyId:t.id});break;case n.OFFER_CHANGE:f=s.href("apply.detail."+o+"offerChange.offerInfo",{applyId:t.id});break;case n.WORK_TARGET:f=s.href("apply.detail."+o+"workTarget",{applyId:t.id});break;case n.FORMAL_APPLY:f=s.href("apply.detail."+o+"formalApply",{applyId:t.id});break;case n.AGENT_ENTER:f=s.href("apply.detail."+o+"agentEnter",{applyId:t.id});break;case n.AGENT_REJOIN:f=s.href("apply.detail."+o+"agentRejoin",{applyId:t.id});break;case n.AGENT_STRUCTURE:f=s.href("apply.detail."+o+"agentStructure",{applyId:t.id});break;case n.AGENT_LEAVE:f=s.href("apply.detail."+o+"agentLeave",{applyId:t.id})}a.viewDetail(f,function(){e.getCountInfo(),e.refreshApplyNum(),E()})}function w(n){confirm("确认撤回该审批吗？",function(){t.cancelApply({id:n.id}).then(function(){info("操作成功"),e.getCountInfo(),E()})})}function E(){t.getApplyList({status:p(e.nav),type:h(),pageDto:{pageNum:e.currentPage||1,pageSize:r.PAGE_SIZE}}).then(function(t){var r=t.data,i=n.STATUS_CODE;for(var s=0,o;o=r[s++];)if(o.status==i.IN_PROCESS||o.status==i.TO_EXCUTE)o.canBeCanceled=!0;e.tableOptions.data=r,e.tableOptions.totalCount=t.pageDto.count})}e.entryName=s.current.name;var f=e.entryName.split(".");e.nav=f[2],e.subNav=f[3],e.showPassBtn=!0,e.showRejectBtn=!0,e.showCancelBtn=!1,e.onPassClick=d,e.onRejectClick=m,e.onSinglePassClick=v,e.onSingleRejectClick=g,e.onTitleClick=b,e.onSingleCancelClick=w,e.tableOptions={data:[],canSelect:!0,totalCount:0,cols:o.getConfig(e),onPageChange:function(t){e.currentPage=t,E()},selectedItems:[]},l()}])});