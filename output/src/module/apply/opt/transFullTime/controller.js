define(["require","../../app","./inputOptions","module/config","../../config","module/codeConfig","moment"],function(e){function a(e,t,o,a,f,l,c){function v(){e.$watch("structure",function(t,n){t!=n&&(b(t.id),w(t),n&&typeof n.id!="undefined"&&(e.level=undefined,e.position=undefined))},!0),e.$watch("level",function(t,n){t!=n&&(w(t),typeof n!="undefined"&&(e.position=undefined))},!0),e.$watch("userCommonInfo",function(t,n){t!=n&&(e.structure={id:t.structure,name:t.structureName})},!0),e.$watch("positiveDate",function(t,n){t!=n&&(e.inputOptions.formalDate.items=[{id:1,name:u(t).add(3,"month").format("YYYY/MM/DD")},{id:2,name:u(t).add(6,"month").format("YYYY/MM/DD")}],e.formalDate=2)}),E(),e.trafficSubsidy={selectVal:h},e.mobileSubsidy={selectVal:h},e.$watch("socialSecurityCity",function(e,t){e?S(e):d={}},!0)}function m(t){e.leader?t.leader.$error.sugguestionRequired=!1:t.leader.$error.sugguestionRequired=!0;if(!t.$valid)return;var n={internsEndDate:e.internsEndDate.getTime(),positiveDate:e.positiveDate.getTime(),formalDate:e.formalDate&&(new Date(e.inputOptions.formalDate.items[e.formalDate-1].name)).getTime(),structure:e.structure.id,leader:f.getUsernameFromSuggestion(e.leader),level:e.level,position:e.position,salaryType:e.salaryType,baseSalary:c.getSalary(e.baseSalary),probationarySalary:c.getSalary(e.probationarySalary),socialSecurityBase:+e.socialSecurityBase,houseFundBase:+e.houseFundBase,trafficSubsidy:c.getSalary(e.trafficSubsidy),mobileSubsidy:c.getSalary(e.mobileSubsidy),socialSecurityCity:e.socialSecurityCity};d.needFiveBase&&(n.endowBase=+e.endowBase,n.unemployBase=+e.unemployBase,n.medicalBase=+e.medicalBase,n.injuryBase=+e.injuryBase,n.maternityBase=+e.maternityBase);if(!f.validateLast7Day("实习/劳务截止日期",n.internsEndDate))return;if(n.internsEndDate>=n.positiveDate){alert("实习/劳务截止日期要早于转正日期");return}if(!f.validateLast7Day("转正日期",n.positiveDate))return;if(!f.validateSocialAndHouseFundBase(n,d))return;f.diffDaysFromNow(e.positiveDate,"days")<i.EXECUTE_TIP_DAYS?confirm(i.TRANSFULL_EXECUTE_TIP,function(){g(n)}):g(n)}function g(n){t.addApply({editedNumber:e.userCommonInfo.number,type:s.APPLY_CODE.TRANS_FULL_MEMBER,content:n,reason:e.reason,executeDate:n.positiveDate}).then(function(){alert(i.SUCCESS_TIP),p.hadSuccess=!0,a.dismiss(p)})}function y(){a.dismiss(p)}function b(t){t?l.getLevel({structure:t}).then(function(t){for(var n=0,i;i=t.data[n++];)i.id=i.name;t.data.unshift(r.EMPTY),e.inputOptions.level.items=t.data}):(e.inputOptions.level.items=[],e.inputOptions.position.items=[])}function w(t){t?l.getPosition({structure:e.structure.id,level:e.level}).then(function(t){t.data.unshift(r.EMPTY),e.inputOptions.position.items=t.data}):e.inputOptions.position.items=[]}function E(){l.getSocialSecurityCity().then(function(t){t.data.unshift(r.EMPTY),e.inputOptions.socialSecurityCity.items=t.data})}function S(t){l.getSocialSecurityCity({socialSecurityCity:t}).then(function(t){d=t.data[0],e.needFiveBase=d.needFiveBase,f.setDefaultSocialBase({},d,e),f.setDefaultHouseBase({},d,e)})}function x(t){f.setDefaultSocialBase({salary:t},d,e),f.setDefaultHouseBase({salary:t},d,e)}e.number=o.get("number"),e.save=m,e.closeHandler=y,e.probationarySalaryChange=x,e.inputOptions=n("transFullTimeForm",e),e.fiveBaseInitOptions={formName:"transFullTimeForm",required:!0};var h=r.SALARY_TYPE[1].id;e.baseSalary={selectVal:h},e.probationarySalary={selectVal:h};var p={},d={};v()}var t=e("../../app"),n=e("./inputOptions"),r=e("module/config"),i=e("../../config"),s=e("module/codeConfig"),o={},u=e("moment");t.controller("applyOptTransFullTime",a),a.$inject=["$scope","applyRequest","localStorage","$modalInstance","util","hrRequest","hrUtil"]});